<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html">
	<h:head>
		<f:metadata>
			<f:viewAction action="#{simulationController.init()}" onPostback="#{simulationController.init()}" />
		</f:metadata>
	</h:head>
	
	<h:body>
	
		<ui:composition template="/WEB-INF/faces/template.xhtml">
			<ui:define name="title">#{text['page.dashboard.title']}</ui:define>
	
			<ui:define name="content">
				<h:form>
				    <f:websocket channel="push" connected="true">
				        <f:ajax event="updateMetric" render=":data" />
				        <f:ajax event="updateImport" render=":import_state :import_select" />
				    </f:websocket>
				</h:form>
				
				<h:panelGroup id="data">
					<div>
						<div id="cal-data">
							<ui:decorate template="/WEB-INF/faces/calculation_card.xhtml">
								<ui:define name="title-card">#{text['face.card.speed']}</ui:define>
								<ui:define name="min-card"><h:outputText value="#{simulationController.speed_calculation.minimum}"/></ui:define>
								<ui:define name="max-card"><h:outputText value="#{simulationController.speed_calculation.maximum}"/></ui:define>
								<ui:define name="average-card"><h:outputText value="#{simulationController.speed_calculation.average}"/></ui:define>
								<ui:define name="unit-card">km/h</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/calculation_card.xhtml">
								<ui:define name="title-card">#{text['face.card.altitude']}</ui:define>
								<ui:define name="min-card"><h:outputText value="#{simulationController.altitude_calculation.minimum}"/></ui:define>
								<ui:define name="max-card"><h:outputText value="#{simulationController.altitude_calculation.maximum}"/></ui:define>
								<ui:define name="average-card"><h:outputText value="#{simulationController.altitude_calculation.average}"/></ui:define>
								<ui:define name="unit-card">km</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/calculation_card.xhtml">
								<ui:define name="title-card">#{text['face.card.acceleration']}</ui:define>
								<ui:define name="min-card"><h:outputText value="#{simulationController.acceleration_calculation.minimum}"/></ui:define>
								<ui:define name="max-card"><h:outputText value="#{simulationController.acceleration_calculation.maximum}"/></ui:define>
								<ui:define name="average-card"><h:outputText value="#{simulationController.acceleration_calculation.average}"/></ui:define>
								<ui:define name="unit-card">m/s²</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/calculation_card.xhtml">
								<ui:define name="title-card">#{text['face.card.thrust']}</ui:define>
								<ui:define name="min-card"><h:outputText value="#{simulationController.thrust_calculation.minimum}"/></ui:define>
								<ui:define name="max-card"><h:outputText value="#{simulationController.thrust_calculation.maximum}"/></ui:define>
								<ui:define name="average-card"><h:outputText value="#{simulationController.thrust_calculation.average}"/></ui:define>
								<ui:define name="unit-card">N</ui:define>
							</ui:decorate>
						</div>
						<div id="main-data">
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.time']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.time}"/></ui:define>
								<ui:define name="unit-card">secondes</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.speed']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.velocity}"/></ui:define>
								<ui:define name="unit-card">km/h</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.altitude']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.altitude}"/></ui:define>
								<ui:define name="unit-card">km</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.acceleration']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.acceleration}"/></ui:define>
								<ui:define name="unit-card">m/s²</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.thrust']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.thrust}"/></ui:define>
								<ui:define name="unit-card">N</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.throttle']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.throttle}"/></ui:define>
								<ui:define name="unit-card">N</ui:define>
							</ui:decorate>
							<ui:decorate template="/WEB-INF/faces/metric_card.xhtml">
								<ui:define name="title-card">#{text['face.card.gravity']}</ui:define>
								<ui:define name="value-card"><h:outputText value="#{simulationController.current_metric.gravity}"/></ui:define>
								<ui:define name="unit-card">N</ui:define>
							</ui:decorate>
						</div>
					</div>
				</h:panelGroup>
				
				<div id='import-panel'>
					<h:panelGroup id="import_state">
					<p><h:outputText value="#{simulationController.import_message}"/></p>
					</h:panelGroup>
					<h:form enctype="multipart/form-data"> 
						<h:outputLabel for="simulation-file" value="#{text['page.dashboard.import']}" />
						<h:inputFile  
							id="simulation-file" 
							value="#{simulationController.import_file}"
							accept="application/json"
						>
							<f:ajax listener="#{simulationController.importSimulation()}" />
						</h:inputFile>
					</h:form> 
				</div>
			</ui:define>
	
		</ui:composition>
	
	</h:body>
</html>